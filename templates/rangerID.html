{% extends "login.html" %}

{% block title%}Forget Password{% endblock%}

{% block formArea%}
<div class="flex md:w-1/2 justify-center py-10 items-center bg-white">
    <form class="bg-white py-5 w-2/3" action="/verify_username" method="post">
        <h1 class="text-gray-800 font-bold text-2xl mb-1">Change password</h1>
        <p class="text-sm font-normal text-gray-600 mb-7">Input your Ranger ID</p>

        {% for message in get_flashed_messages() %}
            <div class="flash mb-3" style="text-align: center; color: crimson;">{{ message }}</div>
        {% endfor %}
        
        <div class="flex items-center border-2 py-2 px-3 rounded-2xl mb-5">
            <i class="fa-solid fa-circle-user"></i>
            <input class="pl-2 w-full outline-none border-none" type="text" name="rangerId" minlength="5" maxlength="8" placeholder="Ranger ID" required/>
        </div>
        
        
        <button type="submit" class="block w-full bg-indigo-600 mt-4 py-2 rounded-2xl text-white font-semibold mb-4">Verify Ranger ID</button>

    </form>
</div>
{% endblock%}

{% block modal%}
<div id="codeModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-6">
    <h4 class="text-gray-800 mb-4 text-center" id="change_pass_mesage" ></h4>

    <form id="codeForm" class="space-y-4">
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition duration-200">OK</button>
    </form>

    </div>

</div>
{% endblock%}

{% block scriptCode%}
<script>
    const showModal = "{{ show_modal }}";
    const email = "{{ email }}"
    
    // Extract the portion before ".gmail.com"
    let emailWithoutDomain = email.split("@gmail.com")[0];

    let firstLetter = emailWithoutDomain.charAt(0);
    let lastLetter = emailWithoutDomain.charAt(emailWithoutDomain.length - 1);

    const modalEmail = `${firstLetter}************${lastLetter}@gmail.com`

    const codeModal = document.getElementById('codeModal');
    const modalTextContent = document.getElementById('change_pass_mesage')
    if (showModal === "True") {
        codeModal.classList.remove('hidden'); // Show the modal
        modalTextContent.innerText = `Change password link has been sent to your email ${modalEmail}. Check it out.`
    }

    document.getElementById('codeForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        window.location.href = '/login';
    });
</script>
{% endblock%}